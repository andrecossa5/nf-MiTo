// Config prova

// Manifest
manifest {
  name = 'nf-MiTo'
  author = 'Andrea Cossa'
  //homePage = 'https://github.com/andrecossa5/nf-MiTo.git'
  description = 'Integrated pipeline for MT-SNVs-based scLT.'
  mainScript = 'main.nf'
  nextflowVersion = '>=20.01.0'
  version = '0.1'
}

// Profiles
profiles {

  conda_garr {
    // workDir = ''
    conda.enabled = true
    conda.envPath = '/home/ieo5505/mambaforge/envs/repro_MI_TO'    
  }
  conda_local {
    // workDir = ''
    conda.enabled = true
    conda.envPath = '/Users/IEO5505/mambaforge/envs/repro_MI_TO'
  }
  local {
    // workDir = ''
    docker.enabled = true
    docker.runOptions = '--volume /Users/:/Users/'
  }
  garr {
    // workDir = ''
    singularity.enabled = true
    singularity.runOptions = '--bind /data/:/data/'
  }

}

// Processes
process {

  // errorStrategy = 'retry'
  // maxRetries = 3
  // scratch = ''


  //


  // common
  withName: MERGE_R1 {
    cpus = 4
    memory = { 1.GB * task.attempt }
    container = 'acox1/mi_to:1.3'
  }
  withName: MERGE_R2 {
    cpus = 4
    memory = { 1.GB * task.attempt }
    container = 'acox1/mi_to:1.3'
  }
  withName: SOLO {
    cpus = 6 
    memory = { 10.GB * task.attempt }
    container = 'acox1/nf-perturbseq:1.0'
  }
  withName: EXTRACT_FASTA {
    cpus = 1
    memory = 1.GB
    container = 'acox1/mi_to:1.0'
  }
  withName: FILTER_BAM_CB {
    cpus = 1
    memory = 4.GB
    container = 'acox1/samtools:1.1'
  }
  withName: SPLIT_BARCODES {
    cpus = 1 
    memory = { 2.GB * task.attempt }
    container = 'acox1/mi_to:1.0'
  }
  withName: SPLIT_BAM {
    cpus = 5
    memory = { 5.GB * task.attempt }
    container = 'acox1/samtools:1.1'
  }
  withName: MAKE_AFM {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }

  
  //


  // maester 
  withName: FILTER_10X_BAM {
    cpus = 4
    memory = { 5.GB * task.attempt }
    container = 'acox1/mi_to:1.3'
  }
  withName: FILTER_MAESTER_BAM {
    cpus = 4
    memory = { 5.GB * task.attempt }
    container = 'acox1/mi_to:1.3'
  }
  withName: MERGE_BAM {
    cpus = 4
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.3'
  }
  withName: CONSENSUS_MITO {
    cpus = 1
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.0'
  }
  withName: GATHER_TABLES {
    cpus = 1
    memory = { 1.GB * task.attempt }
    container = 'acox1/mi_to:1.0'
  }

  //


  // from_bam
  withName: SAMTOOLS {
    cpus = 1 
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: COLLAPSE_SAMTOOLS {
    cpus = 1 
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: FREEBAYES {
    cpus = 1 
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: COLLAPSE_FREEBAYES {
    cpus = 1 
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: CELLSNP {
    cpus = 8 
    memory = { 10.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: INDEX_AND_MERGE {
    cpus = 8 
    memory = { 20.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: MAEGATK {
    cpus = 1
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.1'
  }
  withName: COLLAPSE_MAEGATK {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
  withName: MITO {
    cpus = 1
    memory = { 1.GB * task.attempt }
    container = 'acox1/samtools:1.1'
  }
  withName: COLLAPSE_MITO {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/samtools:1.2'
  }
 
  
  //


  // tune, explore, phylo
  withName: ONESAMPLE {
    cpus = 8
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: VIZ_MT_SPACE {
    cpus = 8
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: MITO {
    cpus = 8
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: scWGS {
    cpus = 8
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: CAS9 {
    cpus = 8
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: DISTANCES {
    cpus = 8
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: DISTANCE_METRICS {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }  
  withName: CASSIOPEIA {
    cpus = 1
    memory = { 5.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: IQTREE {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: BOOSTER {
    cpus = 8
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: MPBOOT {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: TREE_METRICS {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: PROCESS_TREE {
    cpus = 1
    memory = { 10.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  withName: PATH {
    cpus = 1
    memory = { 8.GB * task.attempt }
    container = 'acox1/mi_to:1.2'
  }
  
}

// Tracing
trace {
  enabled = true
  file = "trace.txt"
  overwrite = true
}

// Tracing
tower {
  // accessToken = 'eyJ0aWQiOiAyNn0uODg3NGVhMDMzZjdiNjBkMGUwMTRlNjAyYjA2ODQ5NDBhYjNkODRiNw=='
  // endpoint= 'https://seqera.ieo.it/api'
  enabled = true
  // workspaceId = '178653702436441'
}
